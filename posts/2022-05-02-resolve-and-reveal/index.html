<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Resolve and Reveal | blog.cdaf.io</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="PROPLD and DETOKN Extensions Properties which are mapped to variables can now be directly defined as such. This is particularly useful for values that are only known at deploy time, such as cloud resources which are automatically allocated by the provider or are randomly generated such as UUIDs.
For the following example tokenised settings file, for example variables.tf
variable &#34;terraform_token&#34; { default = &#34;%terraform_token%&#34; } variable &#34;api_ip&#34; { default = &#34;%api_ip%&#34; } variable &#34;redis_cache&#34; { default = &#34;%redis_cache%&#34; } Non-sensitive variable mapping can be applied to the properties.">
    <meta name="generator" content="Hugo 0.133.0">
    
    
    
    
      <meta name="robots" content="index, follow">
    
    

    
<link rel="stylesheet" href="/ananke/css/main.min.d05fb5f317fcf33b3a52936399bdf6f47dc776516e1692e412ec7d76f4a5faa2.css" >



    

    
      
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />


    

    

    
      <link rel="canonical" href="https://blog.cdaf.io/posts/2022-05-02-resolve-and-reveal/">
    

    <meta property="og:url" content="https://blog.cdaf.io/posts/2022-05-02-resolve-and-reveal/">
  <meta property="og:site_name" content="blog.cdaf.io">
  <meta property="og:title" content="Resolve and Reveal">
  <meta property="og:description" content="PROPLD and DETOKN Extensions Properties which are mapped to variables can now be directly defined as such. This is particularly useful for values that are only known at deploy time, such as cloud resources which are automatically allocated by the provider or are randomly generated such as UUIDs.
For the following example tokenised settings file, for example variables.tf
variable &#34;terraform_token&#34; { default = &#34;%terraform_token%&#34; } variable &#34;api_ip&#34; { default = &#34;%api_ip%&#34; } variable &#34;redis_cache&#34; { default = &#34;%redis_cache%&#34; } Non-sensitive variable mapping can be applied to the properties.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2022-05-02T00:00:00+00:00">
    <meta property="article:modified_time" content="2022-05-02T00:00:00+00:00">

  <meta itemprop="name" content="Resolve and Reveal">
  <meta itemprop="description" content="PROPLD and DETOKN Extensions Properties which are mapped to variables can now be directly defined as such. This is particularly useful for values that are only known at deploy time, such as cloud resources which are automatically allocated by the provider or are randomly generated such as UUIDs.
For the following example tokenised settings file, for example variables.tf
variable &#34;terraform_token&#34; { default = &#34;%terraform_token%&#34; } variable &#34;api_ip&#34; { default = &#34;%api_ip%&#34; } variable &#34;redis_cache&#34; { default = &#34;%redis_cache%&#34; } Non-sensitive variable mapping can be applied to the properties.">
  <meta itemprop="datePublished" content="2022-05-02T00:00:00+00:00">
  <meta itemprop="dateModified" content="2022-05-02T00:00:00+00:00">
  <meta itemprop="wordCount" content="231">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Resolve and Reveal">
  <meta name="twitter:description" content="PROPLD and DETOKN Extensions Properties which are mapped to variables can now be directly defined as such. This is particularly useful for values that are only known at deploy time, such as cloud resources which are automatically allocated by the provider or are randomly generated such as UUIDs.
For the following example tokenised settings file, for example variables.tf
variable &#34;terraform_token&#34; { default = &#34;%terraform_token%&#34; } variable &#34;api_ip&#34; { default = &#34;%api_ip%&#34; } variable &#34;redis_cache&#34; { default = &#34;%redis_cache%&#34; } Non-sensitive variable mapping can be applied to the properties.">

      
  


    
	
  </head>

  <body class="ma0 avenir bg-near-white production">

    
   
  

  
  <header class="cover bg-top" style="background-image: url('https://blog.cdaf.io/images/AdobeStock_101375810.jpeg');">
    <div class="bg-black-60">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="/" class="f3 fw2 hover-white no-underline white-90 dib">
      
        blog.cdaf.io
      
    </a>
    <div class="flex-l items-center">
      

      
        <ul class="pl0 mr3">
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/about/" title="About page">
              About
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/articles/" title="Articles page">
              Articles
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/issues/" title="Issues page">
              Issues
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/posts/" title="Posts page">
              Posts
            </a>
          </li>
          
        </ul>
      
      
<div class="ananke-socials">
  
</div>

    </div>
  </div>
</nav>

      <div class="tc-l pv6 ph3 ph4-ns">
        
          <div class="f2 f1-l fw2 white-90 mb0 lh-title">Resolve and Reveal</div>
          
        
      </div>
    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked ttu">
          
        Posts
      </aside>
      










  <div id="sharing" class="mt3 ananke-socials">
    
  </div>


      <h1 class="f1 athelas mt3 mb1">Resolve and Reveal</h1>
      
      
      
      <time class="f6 mv4 dib tracked" datetime="2022-05-02T00:00:00Z">May 2, 2022</time>
      

      
      
    </header>
    <div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><h1 id="propld-and-detokn-extensions">PROPLD and DETOKN Extensions</h1>
<p>Properties which are mapped to variables can now be directly defined as such. This is particularly useful for values that are only known at deploy time, such as cloud resources which are automatically allocated by the provider or are randomly generated such as UUIDs.</p>
<p>For the following example tokenised settings file, for example variables.tf</p>
<pre tabindex="0"><code>variable &#34;terraform_token&#34; { default = &#34;%terraform_token%&#34; }
variable &#34;api_ip&#34;          { default = &#34;%api_ip%&#34; }
variable &#34;redis_cache&#34;     { default = &#34;%redis_cache%&#34; }
</code></pre><p>Non-sensitive variable mapping can be applied to the properties.cm definition</p>
<pre tabindex="0"><code>context  target  workspace_space  redis_cache  api_ip
local    dev     kot-dev          $REDIS_URL   10.240.10.10
local    test    kot-test         $REDIS_URL   10.240.10.11
local    prod    kot-prod         $REDIS_URL   10.240.10.10
</code></pre><p>While secrets, supplied as environment variables, can be defined in CDAF.solution</p>
<pre tabindex="0"><code>artifactPrefix=0.3
solutionName=kot
terraform_token=$ENV:TF_CLOUD_TOKEN
</code></pre><p>In the deploy task, process non-sensitive variables first. Note: to use the new features, the property file must be explicitely supplied.</p>
<pre><code>DETOKN variables.tf $TARGET reveal
</code></pre>
<p>At deploy time non-sensitive nested variables are expanded and displayed</p>
<pre tabindex="0"><code>[Transform.ps1] PROPFILE  : test
[Transform.ps1] TOKENFILE : variables.tf
Found %workspace_space%, replacing with kot-test
Found %redis_cache%, replacing with redis-system-generated.cloud
</code></pre><p>Then secrets can be expanded. Note: all contents of CDAF.solution are packaged with build outputs in manifest.txt</p>
<pre><code>DETOKN variables.tf manifest.txt resolve
</code></pre>
<p>These are not displayed, the origin variable name is logged for debugging</p>
<pre tabindex="0"><code>[Transform.ps1] PROPFILE  : manifest.txt
[Transform.ps1] TOKENFILE : variables.tf
Found %terraform_token%, replacing with $ENV:TF_CLOUD_TOKEN
</code></pre><p>For full release details for CDAF 2.5.1 see <a href="http://cdaf.io/release">http://cdaf.io/release</a></p>
<ul class="pa0">
  
</ul>
<div class="mt6 instapaper_ignoref">
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://blog.cdaf.io/" >
    &copy;  blog.cdaf.io 2024 
  </a>
    <div>
<div class="ananke-socials">
  
</div>
</div>
  </div>
</footer>

  </body>
</html>
